OBJECT Table 53200 Document Module Setup
{
  OBJECT-PROPERTIES
  {
    Date=27.10.16;
    Time=10:23:27;
    Modified=Yes;
    Version List=DOC1.1;
  }
  PROPERTIES
  {
  }
  FIELDS
  {
    { 1   ;   ;Primary Key         ;Code10        ;CaptionML=[ENU=Primary Key;
                                                              NOR=Prim‘rn›kkel] }
    { 2   ;   ;Filename No. Series ;Code20        ;TableRelation="No. Series";
                                                   CaptionML=[ENU=Filename No. Series;
                                                              NOR=Filnavn nr.serie] }
    { 3   ;   ;Storage Location    ;Text250       ;CaptionML=[ENU=Storage Location;
                                                              NOR=Filsti] }
    { 10  ;   ;Storage Type        ;Option        ;CaptionML=[ENU=Storage Type;
                                                              NOR=Lagringstype];
                                                   OptionCaptionML=[ENU=Disk File,Embedded;
                                                                    NOR=Fil p† disk,I database];
                                                   OptionString=Disk File,Embedded }
    { 20  ;   ;Add To Record Link  ;Boolean       ;OnValidate=BEGIN
                                                                IF Rec."Add To Record Link" THEN BEGIN
                                                                  TESTFIELD("Use Attachment Table", FALSE);
                                                                  TESTFIELD("Storage Type", Rec."Storage Type"::"Disk File");
                                                                  TESTFIELD("Storage Location");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Add To Record Link;
                                                              NOR=Legge fil til Koblinger] }
    { 30  ;   ;Use Attachment Table;Boolean       ;OnValidate=BEGIN
                                                                IF "Use Attachment Table" THEN
                                                                  TESTFIELD("Storage Type", Rec."Storage Type"::Embedded);
                                                              END;

                                                   CaptionML=[ENU=Use Attachment Table;
                                                              NOR=Bruke Vedlegg tabellen] }
    { 40  ;   ;Add To Interaction Log;Boolean     ;CaptionML=[ENU=Add Interaction Log Entry;
                                                              NOR=Legg til Samhandlingspost] }
    { 50  ;   ;Add Line To Support Task;Boolean   ;CaptionML=[ENU=Add Line To Support Task;
                                                              NOR=Legg til Supportlinje] }
    { 60  ;   ;Interaction Template Code;Code10   ;TableRelation="Interaction Template";
                                                   CaptionML=[ENU=Interaction Template Code;
                                                              NOR=Samhandlingsmal - kode] }
  }
  KEYS
  {
    {    ;Primary Key                             ;Clustered=Yes }
  }
  FIELDGROUPS
  {
  }
  CODE
  {

    BEGIN
    END.
  }
}

OBJECT Table 53201 Document Module Documents
{
  OBJECT-PROPERTIES
  {
    Date=28.10.16;
    Time=19:06:03;
    Modified=Yes;
    Version List=DOC1.1;
  }
  PROPERTIES
  {
    OnDelete=VAR
               RecRefL@1101103000 : RecordRef;
               AttachmentL@1101103001 : Record 5062;
               InteractionLogEntryL@1101103002 : Record 5065;
             BEGIN
               RecRefL.OPEN("Table No.");
               IF RecRefL.GET(RecordID) THEN
                 RecRefL.DELETELINK("Link ID");
               IF Rec."Attachment No." > 0 THEN BEGIN
                 IF AttachmentL.GET(Rec."Attachment No." ) THEN
                   AttachmentL.DELETE(TRUE);
                 InteractionLogEntryL.SETRANGE("Attachment No.", Rec."Attachment No." );
                 IF InteractionLogEntryL.FINDSET THEN
                   InteractionLogEntryL.DELETEALL(TRUE);
               END;
             END;

    CaptionML=[ENU=Document Module Documents;
               NOR=Dokumentmodul dokumenter];
  }
  FIELDS
  {
    { 1   ;   ;Table No.           ;Integer       ;TableRelation=Object.ID WHERE (Type=CONST(Table)) }
    { 2   ;   ;Line No.            ;Integer       ;CaptionML=[ENU=Line No.;
                                                              NOR=Linjenr.] }
    { 3   ;   ;RecordID            ;RecordID      ;CaptionML=[ENU=Record ID;
                                                              NOR=Record ID] }
    { 7   ;   ;Description         ;Text250       ;CaptionML=[ENU=Description;
                                                              NOR=Beskrivelse] }
    { 10  ;   ;Storage Type        ;Option        ;CaptionML=[ENU=Storage Type;
                                                              NOR=Lagringstype];
                                                   OptionCaptionML=[ENU=Disk File,Embedded;
                                                                    NOR=Fil p† disk,I database];
                                                   OptionString=Disk File,Embedded }
    { 11  ;   ;Attachment          ;BLOB          ;CaptionML=[ENU=Attachment;
                                                              NOR=Vedlegg] }
    { 12  ;   ;Filename No.        ;Code100       ;CaptionML=[ENU=Filename No.;
                                                              NOR=Filnavn nr.] }
    { 13  ;   ;File Extension      ;Text30        ;CaptionML=[ENU=File Extension;
                                                              NOR=Filtype] }
    { 14  ;   ;Date                ;Date          ;CaptionML=[ENU=Date;
                                                              NOR=Dato];
                                                   Editable=No }
    { 15  ;   ;Time                ;Time          ;CaptionML=[ENU=Time;
                                                              NOR=Tid];
                                                   Editable=No }
    { 16  ;   ;Size                ;Integer       ;CaptionML=[ENU=Size;
                                                              NOR=St›rrelse] }
    { 17  ;   ;Storage Pointer     ;Text250       ;OnValidate=BEGIN
                                                                IF COPYSTR("Storage Pointer", STRLEN("Storage Pointer"), 1) <> '\' THEN
                                                                BEGIN
                                                                  "Storage Pointer" += '\';
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Storage Pointer;
                                                              NOR=Lagringssti] }
    { 18  ;   ;Read Only           ;Boolean       ;CaptionML=[ENU=Read Only;
                                                              NOR=Skrivebeskyttet] }
    { 30  ;   ;Link ID             ;Integer        }
    { 200 ;   ;Attachment No.      ;Integer       ;CaptionML=[ENU=Attachment No.;
                                                              NOR=Vedleggnr.] }
  }
  KEYS
  {
    {    ;Table No.,RecordID,Line No.             ;Clustered=Yes }
    {    ;Link ID                                  }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      DocumentModuleSetupG@1101103003 : Record 53200;
      FileMgt@1101103001 : Codeunit 419;
      DocModuleMgt@1101103000 : Codeunit 53201;
      Text002@1101103016 : TextConst 'ENU=The attachment is empty.;NOR=Vedlegget er tomt.';
      Text003@1101103015 : TextConst 'ENU=Attachment is already in use on this machine.;NOR=Vedlegget er allerede i bruk p† denne maskinen.';
      Text004@1101103014 : TextConst 'ENU=When you have saved your document, click Yes to import the document.;NOR=N†r du har lagret dokumentet, klikker du p† Ja for † lese det inn.';
      Text005@1101103013 : TextConst 'ENU=Export Attachment;NOR=Les ut vedlegg';
      Text006@1101103012 : TextConst 'ENU=Import Attachment;NOR=Importer vedlegg';
      Text007@1101103011 : TextConst 'ENU=All Files (*.*)|*.*;NOR=Alle filer (*.*)|*.*';
      Text008@1101103010 : TextConst 'ENU=Error during copying file: %1.;NOR=Feil ved kopiering av fil: %1';
      Text009@1101103009 : TextConst 'ENU=Do you want to remove %1?;NOR=Vil du fjerne %1?';
      Text010@1101103008 : TextConst 'ENU=External file could not be removed.;NOR=Ekstern fil kunne ikke fjernes.';
      NoSeriesMgt@1101103004 : Codeunit 396;

    PROCEDURE ImportAttachmentFromClientFile@5(RecordRefP@1101103003 : RecordRef;ClientFileNameP@1000 : Text;IsTemporaryP@1001 : Boolean;VAR AttachmentNoP@1101103004 : Integer;VAR InteractionLogEntryNoP@1101103002 : Integer) : Boolean;
    VAR
      FileNameL@1005 : Text;
      ServerFileNameL@1010 : Text;
      NewServerFileNameL@1101103001 : Text;
      DocModuleSetupL@1101103000 : Record 53200;
    BEGIN
      IF IsTemporaryP THEN
        EXIT(ImportTemporaryAttachmentFromClientFile(ClientFileNameP));

      DocModuleSetupL.GET;
      IF DocModuleSetupL."Storage Type" = DocModuleSetupL."Storage Type"::"Disk File" THEN
        DocModuleSetupL.TESTFIELD("Storage Location");
      ServerFileNameL := FileMgt.UploadFileSilent(ClientFileNameP);
      FileNameL := FileMgt.GetFileName(ClientFileNameP);
      NewServerFileNameL := FileMgt.CombinePath(TEMPORARYPATH, FileNameL);
      FileMgt.CopyServerFile(ServerFileNameL, NewServerFileNameL, TRUE);
      FileMgt.DeleteServerFile(ServerFileNameL);
      EXIT(ImportAttachmentFromServerFile(RecordRefP, NewServerFileNameL, FALSE, TRUE, FileNameL, AttachmentNoP, InteractionLogEntryNoP));
    END;

    PROCEDURE ConnectAttachmentFromClientFile@1101103000(RecRef@1101103003 : RecordRef;ImportFromFile@1000 : Text;IsTemporary@1001 : Boolean) : Boolean;
    VAR
      FileName@1005 : Text;
      ServerFileName@1010 : Text;
      FilePath@1101103000 : Text;
    BEGIN
      IF IsTemporary THEN
        EXIT(ImportTemporaryAttachmentFromClientFile(ImportFromFile));
      // passing to UPLOAD function when only server path is specified, not ALSO the file name,
      // then function updates the server file path with the actual client name
      ServerFileName := TEMPORARYPATH;
      FileName := ImportFromFile;
      FileName := FileMgt.OpenFileDialog(Text006, '', Text007);
      FilePath := FileMgt.GetDirectoryName(FileName);

      EXIT(ConnectAttachmentFromServerFile(RecRef, FileName , FilePath, FALSE,TRUE));
    END;

    PROCEDURE ImportAttachmentFromServerFile@19(RecRef@1101103001 : RecordRef;ImportFromFile@1000 : Text;IsTemporary@1002 : Boolean;Overwrite@1001 : Boolean;SubjectP@1101103009 : Text[250];VAR AttachmentNoP@1101103007 : Integer;VAR InteractionLogEntryNoP@1101103008 : Integer) : Boolean;
    VAR
      NewDocumentLineNo@1101103000 : Integer;
      DocModuleSetup@1101103002 : Record 53200;
      TempBlob@1101103003 : Record 99008535;
      FileExtensionL@1101103004 : Text[30];
      FileNameL@1101103005 : Text;
      ImportedL@1101103006 : Boolean;
    BEGIN
      ImportedL := FALSE;
      IF ImportFromFile = '' THEN
        EXIT(FALSE);

      IF IsTemporary THEN BEGIN
        ImportTemporaryAttachmentFromServerFile(ImportFromFile);
        EXIT(TRUE);
      END;

      DocModuleSetup.GET;
      IF DocModuleSetup."Storage Type" = DocModuleSetup."Storage Type"::"Disk File" THEN BEGIN
        DocModuleSetup.TESTFIELD("Storage Location");
      END;
      DocModuleSetup.TESTFIELD("Filename No. Series");

      NewDocumentLineNo := InsertNewDocumentRecord(RecRef);
      GET(RecRef.RECORDID.TABLENO, RecRef.RECORDID, NewDocumentLineNo);
      FileExtensionL := COPYSTR(FileMgt.GetExtension(ImportFromFile),1,250);
      FileNameL := FileMgt.GetFileName(ImportFromFile);
      CASE DocModuleSetup."Storage Type" OF
        DocModuleSetup."Storage Type"::Embedded:
          BEGIN
            Date := TODAY;
            Time := Time;
            "Storage Pointer" := '';
            "Storage Type" := "Storage Type"::Embedded;
            "File Extension" := FileExtensionL;
            Description := FileNameL;
            "Filename No." := NoSeriesMgt.GetNextNo(DocModuleSetup."Filename No. Series",TODAY,TRUE);
            IF DocModuleSetup."Use Attachment Table" THEN
              "Attachment No." := DocModuleMgt.InsertAttachment(ImportFromFile, FileExtensionL)
            ELSE BEGIN
              CLEAR(TempBlob);
              FileMgt.BLOBImportFromServerFile(TempBlob,ImportFromFile);
              Attachment := TempBlob.Blob;
            END;
            IF MODIFY(TRUE) AND DocModuleSetup."Add To Record Link" THEN
            BEGIN
              "Link ID" := RecRef.ADDLINK(ConstDiskFileName, Description);
              MODIFY(TRUE) ;
            END;
            FileMgt.DeleteServerFile(ImportFromFile);
            ImportedL := TRUE;
          END;
        "Storage Type"::"Disk File":
          BEGIN
            Date := TODAY;
            Time := Time;
            "Storage Type" := "Storage Type"::"Disk File";
            "Storage Pointer" := DocModuleSetup."Storage Location";
            "File Extension" := FileExtensionL;
            Description := FileNameL;
            "Filename No." := NoSeriesMgt.GetNextNo(DocModuleSetup."Filename No. Series",TODAY,TRUE);
            FileMgt.CopyServerFile(ImportFromFile, ConstDiskFileName, Overwrite); // Copy from UNC location to another UNC location
            IF MODIFY(TRUE) AND DocModuleSetup."Add To Record Link" THEN
            BEGIN
              "Link ID" := RecRef.ADDLINK(ConstDiskFileName, Description);
              MODIFY(TRUE);
            END;
            ImportedL := TRUE;
          END;
      END;
      AttachmentNoP := Rec."Attachment No.";
      IF ImportedL AND DocModuleSetup."Add To Interaction Log" THEN BEGIN
        InteractionLogEntryNoP := InsertInteractionLogEntry(RecRef, FileExtensionL, Rec."Attachment No.", SubjectP);
      END;

      EXIT(ImportedL);
    END;

    PROCEDURE ConnectAttachmentFromServerFile@1101103001(RecRef@1101103002 : RecordRef;ImportFromFile@1000 : Text;FilePath@1101103000 : Text;IsTemporary@1002 : Boolean;Overwrite@1001 : Boolean) : Boolean;
    VAR
      NewDocumentLineNo@1101103001 : Integer;
      DocModuleSetup@1101103003 : Record 53200;
      TempBlob@1101103004 : Record 99008535;
      FileNameL@1101103005 : Text;
      FileExtensionL@1101103006 : Text[30];
    BEGIN

      IF ImportFromFile = '' THEN
        EXIT(FALSE);

      IF IsTemporary THEN BEGIN
        ImportTemporaryAttachmentFromServerFile(ImportFromFile);
        EXIT(TRUE);
      END;

      DocModuleSetup.GET;
      IF DocModuleSetup."Storage Type" = DocModuleSetup."Storage Type"::"Disk File" THEN
        DocModuleSetup.TESTFIELD("Storage Location");
      DocModuleSetup.TESTFIELD("Filename No. Series");

      NewDocumentLineNo := InsertNewDocumentRecord(RecRef);
      GET(RecRef.RECORDID.TABLENO, RecRef.RECORDID, NewDocumentLineNo);
      FileExtensionL := COPYSTR(FileMgt.GetExtension(ImportFromFile),1,250);
      FileNameL := FileMgt.GetFileName(ImportFromFile);
      CASE DocModuleSetup."Storage Type" OF
        DocModuleSetup."Storage Type"::Embedded:
          BEGIN
            Date := TODAY;
            Time := Time;
            "Storage Pointer" := '';
            "Storage Type" := "Storage Type"::Embedded;
            "File Extension" := FileExtensionL;
            Description := FileNameL;
            "Filename No." := FileMgt.GetFileName(ImportFromFile);
            IF DocModuleSetup."Use Attachment Table" THEN
              "Attachment No." := DocModuleMgt.InsertAttachment(ImportFromFile, FileExtensionL)
            ELSE BEGIN
              CLEAR(TempBlob);
              FileMgt.BLOBImportFromServerFile(TempBlob,ImportFromFile);
              Attachment := TempBlob.Blob;
            END;

            IF MODIFY(TRUE) AND DocModuleSetup."Add To Record Link" THEN
            BEGIN
              "Link ID" := RecRef.ADDLINK(ConstDiskFileName, Description);
              MODIFY(TRUE);
            END;
            EXIT(TRUE);
          END;
        "Storage Type"::"Disk File":
          BEGIN
            Date := TODAY;
            Time := Time;
            "Storage Type" := "Storage Type"::"Disk File";
            "Storage Pointer" := FilePath;
            "File Extension" := FileExtensionL;
            Description := FileNameL;
            "Filename No." := FileMgt.GetFileNameWithoutExtension(ImportFromFile);
           // FileMgt.CopyServerFile(ImportFromFile,ConstDiskFileName,Overwrite); // Copy from UNC location to another UNC location
            IF MODIFY(TRUE) AND DocModuleSetup."Add To Record Link" THEN
            BEGIN
              "Link ID" := RecRef.ADDLINK(ConstDiskFileName, Description);
              MODIFY(TRUE);
            END;
            EXIT(TRUE);
          END;
      END;

      EXIT(FALSE);
    END;

    LOCAL PROCEDURE ImportTemporaryAttachmentFromClientFile@21(ImportFromFile@1000 : Text) : Boolean;
    VAR
      FileName@1001 : Text;
      TempBlob@1101103000 : Record 99008535;
    BEGIN
      FileName := FileMgt.BLOBImport(TempBlob,ImportFromFile);

      IF FileName <> '' THEN BEGIN
        Attachment := TempBlob.Blob;
        "Storage Type" := "Storage Type"::Embedded;
        "Storage Pointer" := '';
        "File Extension" := COPYSTR(UPPERCASE(FileMgt.GetExtension(FileName)),1,250);
        EXIT(TRUE);
      END;

      EXIT(FALSE);
    END;

    LOCAL PROCEDURE ImportTemporaryAttachmentFromServerFile@22(ImportFromFile@1000 : Text);
    VAR
      TempBlob@1101103000 : Record 99008535;
    BEGIN
      FileMgt.BLOBImportFromServerFile(TempBlob,ImportFromFile);
      Attachment := TempBlob.Blob;
      "Storage Type" := "Storage Type"::Embedded;
      "Storage Pointer" := '';
      "File Extension" := COPYSTR(UPPERCASE(FileMgt.GetExtension(ImportFromFile)),1,250);
    END;

    PROCEDURE DeleteFile@10(FilePath@1001 : Text[250]) : Boolean;
    VAR
      I@1002 : Integer;
    BEGIN
      IF FilePath = '' THEN
        EXIT(FALSE);

      IF NOT FileMgt.ClientFileExists(FilePath) THEN
        EXIT(TRUE);

      REPEAT
        SLEEP(250);
        I := I + 1;
      UNTIL FileMgt.DeleteClientFile(FilePath) OR (I = 25);
      EXIT(NOT FileMgt.ClientFileExists(FilePath));
    END;

    PROCEDURE ConstFilename@9() FileName@1000 : Text;
    BEGIN
      FileName := FileMgt.ClientTempFileName("File Extension");
    END;

    PROCEDURE ConstDiskFileName@3() DiskFileName@1000 : Text;
    BEGIN
      IF COPYSTR("Storage Pointer", STRLEN("Storage Pointer"), 1) <> '\' THEN
        DiskFileName := "Storage Pointer" + '\' + FORMAT("Filename No.") + '.' + "File Extension"
      ELSE
        DiskFileName := "Storage Pointer" + FORMAT("Filename No.") + '.' + "File Extension";
    END;

    PROCEDURE InsertNewDocumentRecord@1101103002(RecRef@1101103002 : RecordRef) : Integer;
    VAR
      Document@1101103001 : Record 53201;
    BEGIN
      Document.INIT;
      Document."Table No." := RecRef.RECORDID.TABLENO;
      Document."Line No." := GetNextLineNo(RecRef);
      Document.RecordID := RecRef.RECORDID;
      Document.INSERT;

      EXIT(Document."Line No.");
    END;

    PROCEDURE GetNextLineNo@1101103003(RecRef@1101103000 : RecordRef) : Integer;
    VAR
      Document@1101103001 : Record 53201;
    BEGIN
      Document.SETRANGE("Table No.", RecRef.RECORDID.TABLENO);
      Document.SETRANGE(RecordID, RecRef.RECORDID);
      IF Document.FINDLAST THEN
        EXIT(Document."Line No." + 1)
      ELSE
        EXIT(0);
    END;

    PROCEDURE InsertInteractionLogEntry@1101103004(VAR RecordRefP@1101103000 : RecordRef;FileExtP@1101103002 : Text[30];VAR AttachmentNoP@1101103001 : Integer;DescriptionP@1101103004 : Text[250]) : Integer;
    VAR
      SalesHeaderL@1101103003 : Record 36;
      InteractionLogEntryNoL@1101103005 : Integer;
    BEGIN
      InteractionLogEntryNoL := 0;
      DocumentModuleSetupG.GET;
      CASE RecordRefP.RECORDID.TABLENO OF
        DATABASE::"Sales Header":
        BEGIN
          RecordRefP.SETTABLE(SalesHeaderL);
          InteractionLogEntryNoL := DocModuleMgt.InsertInteractionLogEntry(SalesHeaderL."Sell-to Contact No.", DescriptionP, FileExtP, AttachmentNoP, DocumentModuleSetupG."Interaction Template Code")
        END;
      END;
      EXIT(InteractionLogEntryNoL);
    END;

    BEGIN
    {
      +---------------------------------------------+
      | SI-Data                                     |
      +---------------------------------------------+
      No. Date     Id  Description
      01. 12.11.14 JAL Created the object
    }
    END.
  }
}

OBJECT Codeunit 53200 Document Module Files
{
  OBJECT-PROPERTIES
  {
    Date=28.10.16;
    Time=19:53:32;
    Modified=Yes;
    Version List=DOC1.1;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      DocumentModuleSetupG@1101103004 : Record 53200;
      FileManagementG@1101103000 : Codeunit 419;
      Text001@1101103002 : TextConst 'ENU=Import document from file;NOR=Importer dokument fra fil';
      DocumentModuleManagementG@1101103003 : Codeunit 53201;
      DocumentPageG@1101103001 : Page 53201;

    PROCEDURE ShowDocuments@1101103001(RecordRefP@1101103002 : RecordRef);
    VAR
      Documents@1101103001 : Record 53201;
      RecId@1101103003 : RecordID;
    BEGIN
      RecId := RecordRefP.RECORDID;

      Documents.SETCURRENTKEY("Table No.", RecordID, "Line No.");
      Documents.SETRANGE("Table No.", RecId.TABLENO);
      Documents.SETRANGE(RecordID, RecId);

      DocumentPageG.SetRecordRef(RecordRefP);
      DocumentPageG.SETTABLEVIEW(Documents);
      DocumentPageG.RUN;
    END;

    PROCEDURE ShowDocument@1101103006(VAR DocumentModuleDocumentsP@1101103004 : Record 53201);
    VAR
      AttachmentL@1101103001 : Record 5062;
      FileNameL@1101103000 : Text[250];
    BEGIN
      IF DocumentModuleDocumentsP."Attachment No." = 0 THEN BEGIN
        DocumentModuleSetupG.GET;
        IF DocumentModuleSetupG."Storage Type" = DocumentModuleSetupG."Storage Type"::"Disk File" THEN
          HYPERLINK(DocumentModuleDocumentsP.ConstDiskFileName);
        EXIT;
      END;
      IF AttachmentL.GET(DocumentModuleDocumentsP."Attachment No.") THEN
        AttachmentL.OpenAttachment('Attachment', TRUE, '');
    END;

    PROCEDURE ImportDocument@1101103000(RecRef@1101103003 : RecordRef);
    VAR
      DocumentModuleDocumentsL@1101103002 : Record 53201;
      FileNameL@1101103001 : Text[250];
      AttachmentNoL@1101103000 : Integer;
      InteractionLogEntryNoL@1101103004 : Integer;
    BEGIN
      DocumentModuleDocumentsL.ImportAttachmentFromClientFile(RecRef, FileNameL, FALSE, AttachmentNoL, InteractionLogEntryNoL);
    END;

    PROCEDURE ImportDocumentFromFile@1101103004(RecordRefP@1101103003 : RecordRef;FileNameP@1101103000 : Text[250]);
    VAR
      DocumentModuleDocumentsL@1101103002 : Record 53201;
      AttachmentNoL@1101103004 : Integer;
      InteractionLogEntryNoL@1101103001 : Integer;
    BEGIN
      DocumentModuleDocumentsL.ImportAttachmentFromClientFile(RecordRefP, FileNameP, FALSE, AttachmentNoL, InteractionLogEntryNoL);
    END;

    PROCEDURE SaveFileToClient@1101103007(VAR DocumentModuleDocumentsP@1101103000 : Record 53201);
    VAR
      DocModDocumentsL@1101103002 : Record 53201;
    BEGIN
      DocumentModuleManagementG.SaveFileToClient(DocumentModuleDocumentsP);
    END;

    PROCEDURE ConnectDocument@1101103002(RecRef@1101103003 : RecordRef);
    VAR
      Documents@1101103002 : Record 53201;
      FileName@1101103001 : Text[250];
    BEGIN
      Documents.ConnectAttachmentFromClientFile(RecRef, FileName, FALSE);
    END;

    PROCEDURE DeleteDocument@1101103003(FileName@1101103000 : Text[250]);
    VAR
      Documents@1101103001 : Record 53201;
    BEGIN
      Documents.DeleteFile(FileName);
    END;

    PROCEDURE DeleteDocumentByAttachmentNo@1101103009(AttachmentNoP@1101103000 : Integer);
    VAR
      Documents@1101103001 : Record 53201;
    BEGIN
      IF AttachmentNoP <= 0 THEN
        EXIT;
      Documents.SETRANGE("Attachment No.", AttachmentNoP);
      IF Documents.FINDSET THEN
        Documents.DELETEALL(TRUE);
    END;

    PROCEDURE RenameDocuments@1101103005(NewRecRef@1101103002 : RecordRef;OldRecRef@1101103000 : RecordRef);
    VAR
      Documents@1101103001 : Record 53201;
      RecId@1101103003 : RecordID;
      DocumentRec@1101103004 : Record 53201;
    BEGIN
      RecId := OldRecRef.RECORDID;
      Documents.SETRANGE("Table No.", RecId.TABLENO);
      Documents.SETRANGE(RecordID, RecId);
      IF Documents.FINDSET THEN
      REPEAT
        DocumentRec.GET(OldRecRef.RECORDID.TABLENO, OldRecRef.RECORDID, Documents."Line No.");
        DocumentRec.RENAME(NewRecRef.RECORDID.TABLENO, NewRecRef.RECORDID, Documents."Line No.");
      UNTIL Documents.NEXT <= 0;
    END;

    BEGIN
    {
      +---------------------------------------------+
      | SI-Data                                     |
      +---------------------------------------------+
      No. Date     Id  Description
      01. 12.11.14 JAL Created the object
    }
    END.
  }
}

OBJECT Codeunit 53201 Document Module Management
{
  OBJECT-PROPERTIES
  {
    Date=07.11.16;
    Time=14:50:05;
    Modified=Yes;
    Version List=DOC1.1;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=Send attachments...\\;NOR=Send vedlegg...\\';
      Text001@1001 : TextConst 'ENU=Preparing;NOR=Forbereder';
      Text002@1002 : TextConst 'ENU=Deliver misc.;NOR=Lever div.';
      Text008@1003 : TextConst 'ENU=You must select an interaction template with an attachment.;NOR=Du m† velge en samhandlingsmal med et vedlegg.';
      Text003@1101103000 : TextConst 'ENU=Save File;NOR=Lagre fil';

    PROCEDURE InsertAttachmentNo@14(AttachmentNo@1000 : Integer) : Integer;
    VAR
      Attachment@1001 : Record 5062;
      Attachment3@1003 : Record 5062;
    BEGIN
      IF AttachmentNo <> 0 THEN BEGIN
        Attachment.GET(AttachmentNo);
        IF Attachment."Storage Type" = Attachment."Storage Type"::Embedded THEN
          Attachment.CALCFIELDS("Attachment File");
        Attachment3 := Attachment; // Remember "from" attachment
      END;

      Attachment.INSERT(TRUE);

      IF AttachmentNo <> 0 THEN
        // New attachment is based on old attachment
        TransferAttachment(Attachment3,Attachment); // Transfer attachments of different types.

      EXIT(Attachment."No.");
    END;

    PROCEDURE Send@1(VAR DeliverySorter@1000 : Record 5074);
    VAR
      Attachment@1001 : Record 5062;
      TempDeliverySorterWord@1002 : TEMPORARY Record 5074;
      TempDeliverySorterOther@1003 : TEMPORARY Record 5074;
      InteractLogEntry@1004 : Record 5065;
      Contact@1005 : Record 5050;
      FileMgt@1012 : Codeunit 419;
      WordManagement@1006 : Codeunit 5054;
      Mail@1007 : Codeunit 397;
      FileName@1008 : Text;
      Window@1009 : Dialog;
      NoOfAttachments@1010 : Integer;
      I@1011 : Integer;
    BEGIN
      Window.OPEN(
        Text000 +
        '#1############ @2@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\' +
        '#3############ @4@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@');

      Window.UPDATE(1,Text001);
      Window.UPDATE(3,Text002);

      IF DeliverySorter.FIND('-') THEN BEGIN
        NoOfAttachments := DeliverySorter.COUNT;
        REPEAT
          DeliverySorter.TESTFIELD("Correspondence Type");
          IF NOT Attachment.GET(DeliverySorter."Attachment No.") THEN
            ERROR(Text008);

          IF WordManagement.IsWordDocumentExtension(Attachment."File Extension")
          THEN BEGIN
            TempDeliverySorterWord := DeliverySorter;
            TempDeliverySorterWord.INSERT;
          END ELSE BEGIN
            TempDeliverySorterOther := DeliverySorter;
            TempDeliverySorterOther.INSERT;
          END;
          I := I + 1;
          Window.UPDATE(2,ROUND(I / NoOfAttachments * 10000,1));
        UNTIL DeliverySorter.NEXT = 0;
      END;

      // MS Word merge
      IF TempDeliverySorterWord.FINDFIRST THEN
        WordManagement.Merge(TempDeliverySorterWord);

      // Deliver other types
      IF TempDeliverySorterOther.FIND('-') THEN BEGIN
        I := 0;
        NoOfAttachments := TempDeliverySorterOther.COUNT;
        REPEAT
          InteractLogEntry.LOCKTABLE;
          InteractLogEntry.GET(TempDeliverySorterOther."No.");
          IF TempDeliverySorterOther."Correspondence Type" = TempDeliverySorterOther."Correspondence Type"::Email THEN BEGIN
            Attachment.GET(TempDeliverySorterOther."Attachment No.");
            Attachment.TESTFIELD("File Extension");
            FileName := FileMgt.ServerTempFileName(Attachment."File Extension");
            Attachment.ExportAttachmentToServerFile(FileName);
            Contact.GET(InteractLogEntry."Contact No.");
            //NAV 2013R2 Mail.NewMessage(InteractionEMail(InteractLogEntry),'',TempDeliverySorterOther.Subject,'',FileName,FALSE);
            Mail.NewMessage(InteractionEMail(InteractLogEntry),'', '', TempDeliverySorterOther.Subject,'',FileName,FALSE);
            InteractLogEntry."Delivery Status" := InteractLogEntry."Delivery Status"::" ";
            InteractLogEntry.MODIFY;
          END ELSE BEGIN
            InteractLogEntry."Delivery Status" := InteractLogEntry."Delivery Status"::Error;
            InteractLogEntry.MODIFY;
          END;
          COMMIT;
          I := I + 1;
          Window.UPDATE(4,ROUND(I / NoOfAttachments * 10000,1));
        UNTIL TempDeliverySorterOther.NEXT = 0;
      END;
      Window.CLOSE;
    END;

    LOCAL PROCEDURE TransferAttachment@5(FromAttachment@1000 : Record 5062;VAR ToAttachment@1001 : Record 5062);
    VAR
      RMSetup@1002 : Record 5079;
      FileName@1003 : Text;
    BEGIN
      // Transfer attachments of different types

      IF (FromAttachment."Storage Type" = FromAttachment."Storage Type"::Embedded) AND
         (ToAttachment."Storage Type" = ToAttachment."Storage Type"::"Disk File")
      THEN BEGIN
        FileName := ToAttachment.ConstDiskFileName;
        FromAttachment.ExportAttachmentToServerFile(FileName); // Export blob to UNC location
        WITH ToAttachment DO BEGIN
          CLEAR("Attachment File");
          RMSetup.GET;
          RMSetup.TESTFIELD("Attachment Storage Location");
          "Storage Pointer" := RMSetup."Attachment Storage Location";
          MODIFY;
        END;
      END;

      IF (FromAttachment."Storage Type" = FromAttachment."Storage Type"::"Disk File") AND
         (ToAttachment."Storage Type" = ToAttachment."Storage Type"::"Disk File")
      THEN BEGIN
        // Copy external attachment (to new storage)
        RMSetup.GET;
        RMSetup.TESTFIELD("Attachment Storage Location");
        ToAttachment."Storage Pointer" := RMSetup."Attachment Storage Location";
        ToAttachment.MODIFY;
        FILE.COPY(FromAttachment.ConstDiskFileName,ToAttachment.ConstDiskFileName);
      END;

      IF (FromAttachment."Storage Type" = FromAttachment."Storage Type"::"Disk File") AND
         (ToAttachment."Storage Type" = ToAttachment."Storage Type"::Embedded)
      THEN
        // Transfer External to Embedded attachment
        WITH ToAttachment DO BEGIN
          ImportAttachmentFromServerFile(FromAttachment.ConstDiskFileName,TRUE,FALSE); // Import file from UNC location
          "File Extension" := FromAttachment."File Extension";
          "Storage Pointer" := '';
          MODIFY;
        END;
    END;

    PROCEDURE InteractionEMail@6(VAR InteractLogEntry@1000 : Record 5065) : Text[80];
    VAR
      Cont@1001 : Record 5050;
      ContAltAddr@1002 : Record 5051;
    BEGIN
      IF InteractLogEntry."Contact Alt. Address Code" = '' THEN BEGIN
        Cont.GET(InteractLogEntry."Contact No.");
        EXIT(Cont."E-Mail");
      END;
      ContAltAddr.GET(InteractLogEntry."Contact No.",InteractLogEntry."Contact Alt. Address Code");
      IF ContAltAddr."E-Mail" <> '' THEN
        EXIT(ContAltAddr."E-Mail");

      Cont.GET(InteractLogEntry."Contact No.");
      EXIT(Cont."E-Mail");
    END;

    PROCEDURE InteractionFax@7(VAR InteractLogEntry@1000 : Record 5065) : Text[30];
    VAR
      Cont@1001 : Record 5050;
      ContAltAddr@1002 : Record 5051;
    BEGIN
      IF InteractLogEntry."Contact Alt. Address Code" = '' THEN BEGIN
        Cont.GET(InteractLogEntry."Contact No.");
        EXIT(Cont."Fax No.");
      END;
      ContAltAddr.GET(InteractLogEntry."Contact No.",InteractLogEntry."Contact Alt. Address Code");
      IF ContAltAddr."Fax No." <> '' THEN
        EXIT(ContAltAddr."Fax No.");

      Cont.GET(InteractLogEntry."Contact No.");
      EXIT(Cont."Fax No.");
    END;

    PROCEDURE DownloadFileToClient@1000000015(VAR DocumentModuleDocumentsP@1000000002 : Record 53201;ClientFileNameP@1000000001 : Text) : Text[250];
    VAR
      DocumentModuleSetupL@82100 : Record 53200;
      AttachmentL@82101 : Record 5062;
      FileNameL@1000000000 : Text;
      FileManagementL@1101103000 : Codeunit 419;
    BEGIN
      IF ClientFileNameP = '' THEN
        ClientFileNameP := FileManagementL.ClientTempFileName(DocumentModuleDocumentsP."File Extension");
      FileNameL := FileManagementL.ServerTempFileName(DocumentModuleDocumentsP."File Extension");
      IF DocumentModuleSetupL."Use Attachment Table" THEN BEGIN
        IF AttachmentL.GET(DocumentModuleDocumentsP."Attachment No.") THEN BEGIN
          AttachmentL.CALCFIELDS(AttachmentL."Attachment File");
          AttachmentL."Attachment File".EXPORT(FileNameL);
        END;
      END ELSE BEGIN
        DocumentModuleDocumentsP.CALCFIELDS(Attachment);
        DocumentModuleDocumentsP.Attachment.EXPORT(FileNameL);
      END;
      FileManagementL.DownloadToFile(FileNameL, ClientFileNameP);
      FileManagementL.DeleteServerFile(FileNameL);
      EXIT(ClientFileNameP);
    END;

    PROCEDURE SaveFileToClient@1101103000(VAR DocumentModuleDocumentsP@1101103000 : Record 53201);
    VAR
      FileManagementL@1101103001 : Codeunit 419;
      FileNameL@1101103002 : Text;
    BEGIN
      FileNameL := FileManagementL.SaveFileDialog(Text003, DocumentModuleDocumentsP.Description,'');
      DownloadFileToClient(DocumentModuleDocumentsP, FileNameL);
    END;

    PROCEDURE InsertAttachment@1101390361(FileNameP@1101390367 : Text;FileExtensionP@1101103000 : Text[30]) : Integer;
    VAR
      Attachment@1101390361 : Record 5062;
      Attachment2@1101390360 : Record 5062;
      NextNo@1101390362 : Integer;
      TempFile@1101390366 : File;
    BEGIN
      Attachment2.RESET;
      IF Attachment2.FINDLAST THEN
        NextNo :=  Attachment2."No." + 1
      ELSE
         NextNo := 0;
      Attachment.INIT;
      Attachment."No." := NextNo;
      Attachment."Attachment File".IMPORT(FileNameP);
      Attachment."Storage Type" := Attachment."Storage Type"::Embedded;
      Attachment."File Extension" := FileExtensionP;
      Attachment."Read Only" := TRUE;
      Attachment."Last Date Modified" := TODAY;
      Attachment."Last Time Modified" := TIME;
      Attachment.INSERT(TRUE);

      EXIT(NextNo);
    END;

    PROCEDURE InsertInteractionLogEntry@1101103002(ContactNoP@1101390361 : Code[20];SubjectP@1101390362 : Text[250];FileExtP@1101390363 : Text[30];AttachmentNoP@1101103003 : Integer;TemplateCodeP@1101103001 : Code[10]) : Integer;
    VAR
      Contact@1101390367 : Record 5050;
      InteractionLogEntryL@1101390365 : Record 5065;
      NextEntryNo@1101390366 : Integer;
    BEGIN
      Contact.GET(ContactNoP);
      InteractionLogEntryL.RESET;
      IF InteractionLogEntryL.FINDLAST THEN
        NextEntryNo :=  InteractionLogEntryL."Entry No." + 1
      ELSE
         NextEntryNo := 0;
      InteractionLogEntryL.INIT;
      InteractionLogEntryL."Entry No." := NextEntryNo;
      InteractionLogEntryL.VALIDATE("Contact Company No.", Contact."Company No.");
      InteractionLogEntryL.VALIDATE("Contact No.", ContactNoP);
      InteractionLogEntryL.VALIDATE("Interaction Template Code", TemplateCodeP);
      InteractionLogEntryL.Date := TODAY;
      InteractionLogEntryL.Description := COPYSTR(SubjectP, 1, MAXSTRLEN(InteractionLogEntryL.Description));
      InteractionLogEntryL.Subject := COPYSTR(SubjectP, 1, MAXSTRLEN(InteractionLogEntryL.Subject));
      InteractionLogEntryL."Attachment No." := AttachmentNoP;
      InteractionLogEntryL.INSERT(TRUE);
      EXIT(InteractionLogEntryL."Entry No.");
    END;

    LOCAL PROCEDURE InsertClientAddIn@17(ControlAddInName@1000 : Text[220];PublicKeyToken@1001 : Text[20];Version@1002 : Text[25];Category@1006 : Option;Description@1003 : Text[250];ResourceFilePath@1005 : Text[250]);
    VAR
      ClientAddIn@1004 : Record 2000000069;
    BEGIN
      IF ClientAddIn.GET(ControlAddInName,PublicKeyToken,Version) THEN
        EXIT;

      ClientAddIn.INIT;
      ClientAddIn."Add-in Name" := ControlAddInName;
      ClientAddIn."Public Key Token" := PublicKeyToken;
      ClientAddIn.Version := Version;
      ClientAddIn.Category := Category;
      ClientAddIn.Description := Description;
      IF EXISTS(ResourceFilePath) THEN
        ClientAddIn.Resource.IMPORT(ResourceFilePath);
      IF ClientAddIn.INSERT THEN;
    END;

    PROCEDURE InsertClientAddIns@8();
    VAR
      ClientAddIn@1000 : Record 2000000069;
    BEGIN
      InsertClientAddIn(
        'Incadea.DropAreaControlAddIn','c7fbc976bcfb9a00','',
        ClientAddIn.Category::"DotNet Control Add-in",
        'Incadea Norway Drag and Drop control add-in','');
    END;

    [EventSubscriber(Codeunit,80,OnAfterPostSalesDoc)]
    LOCAL PROCEDURE COD80OnAfterPostSalesDoc@82100(VAR SalesHeader@82100 : Record 36;VAR GenJnlPostLine@82101 : Codeunit 12;SalesShptHdrNo@82102 : Code[20];RetRcpHdrNo@82103 : Code[20];SalesInvHdrNo@82104 : Code[20];SalesCrMemoHdrNo@82105 : Code[20]);
    VAR
      DocumentModuleFilesL@82106 : Codeunit 53200;
      SalesInvoiceHeaderL@82109 : Record 112;
      SalesCrMemoHeaderL@82110 : Record 114;
      OldRecordRefL@82108 : RecordRef;
      NewRecordRefL@82107 : RecordRef;
    BEGIN
      IF SalesInvoiceHeaderL.GET(SalesInvHdrNo) THEN
        NewRecordRefL.GETTABLE(SalesInvoiceHeaderL)
      ELSE IF SalesCrMemoHeaderL.GET(SalesCrMemoHdrNo) THEN
        NewRecordRefL.GETTABLE(SalesCrMemoHeaderL)
      ELSE
        EXIT;

      OldRecordRefL.GETTABLE(SalesHeader);
      DocumentModuleFilesL.RenameDocuments(NewRecordRefL, OldRecordRefL);
    END;

    BEGIN
    {
      +---------------------------------------------+
      | SI-Data                                     |
      +---------------------------------------------+
      No. Date     Id  Description
      01. 12.11.14 JAL Created the object
    }
    END.
  }
}

OBJECT Codeunit 53202 Docment Helper SaveDocument
{
  OBJECT-PROPERTIES
  {
    Date=28.10.16;
    Time=23:02:05;
    Modified=Yes;
    Version List=DOC1.1;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {

    PROCEDURE SaveDroppedDocument@82100(DragEventArgsP@82100 : DotNet "'System.Windows.Forms, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Windows.Forms.DragEventArgs");
    BEGIN
    END;

    PROCEDURE Test@82101(IntP@82100 : Integer) : Text;
    BEGIN
      EXIT(FORMAT(IntP));
    END;

    BEGIN
    END.
  }
}

OBJECT MenuSuite 1090 Dept - Company
{
  OBJECT-PROPERTIES
  {
    Date=28.10.16;
    Time=08:42:58;
    Modified=Yes;
    Version List=DOC1.1;
  }
  PROPERTIES
  {
  }
  MENUNODES
  {
    {                ;[{8B53F309-FB1D-47BA-A2FE-1460E0D5ECDB}] ;NextNodeID=[{7D84E2C7-9D7A-4DA2-87C1-DDBB9435B63C}] }
    { MenuItem       ;[{7D84E2C7-9D7A-4DA2-87C1-DDBB9435B63C}] ;Name=Item Tracking Codes;
                                                                CaptionML=[ENU=Item Tracking Codes;
                                                                           NOR=Varesporingskoder];
                                                                RunObjectType=Page;
                                                                RunObjectID=6502;
                                                                Visible=Yes;
                                                                DepartmentCategory=Lists }
    { MenuItem       ;[{49448471-4DCE-4BAC-B6A9-BD8614D01A48}] ;Name=Transfer Routes;
                                                                CaptionML=[ENU=Transfer Routes;
                                                                           NOR=Overf›ringsruter];
                                                                RunObjectType=Page;
                                                                RunObjectID=5747;
                                                                Visible=Yes;
                                                                DepartmentCategory=Tasks }
    { MenuItem       ;[{81D2CE2C-6499-43ED-9A0B-398248B6B87B}] ;Name=Item Journal Templates;
                                                                CaptionML=[ENU=Item Journal Templates;
                                                                           NOR=Varekladdemaler];
                                                                RunObjectType=Page;
                                                                RunObjectID=102;
                                                                Visible=Yes;
                                                                DepartmentCategory=Lists }
    { MenuItem       ;[{7CEA59FF-A695-44FD-A274-BF6178760FD7}] ;Name=Report Selections Inventory;
                                                                CaptionML=[ENU=Report Selections Inventory;
                                                                           NOR=Rapportvalg - beholdning];
                                                                RunObjectType=Page;
                                                                RunObjectID=5754;
                                                                Visible=Yes;
                                                                NextNodeID=[{00000000-0000-0000-0000-000000000000}];
                                                                DepartmentCategory=Tasks }
    {                ;[{502E3FFC-A7CC-48F7-88A4-89A841F0C628}] ;NextNodeID=[{F17F96B7-D5DF-4C82-B90E-D172A36E4942}] }
    { MenuItem       ;[{F17F96B7-D5DF-4C82-B90E-D172A36E4942}] ;Name=Incoming Documents Setup;
                                                                CaptionML=[ENU=Incoming Documents Setup;
                                                                           NOR=Oppsett for inng†ende dokumenter];
                                                                ApplicationArea=#Suite;
                                                                RunObjectType=Page;
                                                                RunObjectID=191;
                                                                Visible=Yes;
                                                                DepartmentCategory=Tasks }
    {                ;[{BAD8AF38-254A-4266-AF07-EDC55674B5FA}] ;NextNodeID=[{A2E2F2F9-5AB0-4C65-9A60-F9BAE2B24023}] }
    { MenuItem       ;[{A2E2F2F9-5AB0-4C65-9A60-F9BAE2B24023}] ;Name=VAT Clauses;
                                                                CaptionML=[ENU=VAT Clauses;
                                                                           NOR=Mva-setninger];
                                                                ApplicationArea=#Basic,#Suite;
                                                                RunObjectType=Page;
                                                                RunObjectID=747;
                                                                Visible=Yes;
                                                                DepartmentCategory=Administration }
    {                ;[{9474DF8C-B0E7-4FED-AF54-367E0639F7B0}] ;NextNodeID=[{C68C0462-288A-42CC-8BC7-6F224D8846CE}] }
    { MenuItem       ;[{C68C0462-288A-42CC-8BC7-6F224D8846CE}] ;Name=VAT Clauses;
                                                                CaptionML=[ENU=VAT Clauses;
                                                                           NOR=Mva-setninger];
                                                                ApplicationArea=#Basic,#Suite;
                                                                RunObjectType=Page;
                                                                RunObjectID=747;
                                                                Visible=Yes;
                                                                DepartmentCategory=Tasks }
    {                ;[{44DC36A4-3D38-427C-B37D-02811193E52A}] ;NextNodeID=[{E0433AFB-5B38-4E2F-ADE7-0317B7ADE93D}] }
    { MenuItem       ;[{E0433AFB-5B38-4E2F-ADE7-0317B7ADE93D}] ;Name=Application Area;
                                                                CaptionML=[ENU=Application Area;
                                                                           NOR=Modul];
                                                                ApplicationArea=#All;
                                                                RunObjectType=Page;
                                                                RunObjectID=9179;
                                                                Visible=Yes;
                                                                DepartmentCategory=Tasks }
    { MenuItem       ;[{9CBA63AC-73D3-438F-818D-476B76D5DB75}] ;Name=Data Exchange Definition;
                                                                CaptionML=[ENU=Data Exchange Definitions;
                                                                           NOR=Datautvekslingsdefinisjoner];
                                                                ApplicationArea=#Basic,#Suite;
                                                                RunObjectType=Page;
                                                                RunObjectID=1211;
                                                                Visible=Yes;
                                                                DepartmentCategory=Lists }
    { MenuItem       ;[{BB2D12FC-2EEB-4165-869B-098BBB42C6F6}] ;Name=Bank Export/Import Setup;
                                                                CaptionML=[ENU=Bank Export/Import Setup;
                                                                           NOR=Konfigurasjon av bankeksport/-import];
                                                                ApplicationArea=#Basic,#Suite;
                                                                RunObjectType=Page;
                                                                RunObjectID=1200;
                                                                Visible=Yes;
                                                                DepartmentCategory=Tasks }
    { MenuItem       ;[{C0BECAC0-F100-4C39-BBCA-714333A54406}] ;Name=SEPA Schema Viewer;
                                                                CaptionML=[ENU=SEPA Schema Viewer;
                                                                           NOR=Visningsprogram for SEPA-skjema];
                                                                ApplicationArea=#Basic,#Suite;
                                                                RunObjectType=Page;
                                                                RunObjectID=9610;
                                                                Visible=Yes;
                                                                DepartmentCategory=Tasks }
    { MenuItem       ;[{7FD6154D-F047-4A31-B857-0DA1E0BA97D8}] ;Name=XML Schemas;
                                                                CaptionML=[ENU=XML Schemas;
                                                                           NOR=XML-skjemaer];
                                                                ApplicationArea=#Basic,#Suite;
                                                                RunObjectType=Page;
                                                                RunObjectID=9600;
                                                                Visible=Yes;
                                                                DepartmentCategory=Tasks }
    { MenuItem       ;[{E55ED739-BBB9-4063-AF58-225E99C5FE72}] ;Name=Document Sending Profiles;
                                                                CaptionML=[ENU=Document Sending Profiles;
                                                                           NOR=Profiler for dokumentsending];
                                                                ApplicationArea=#Basic,#Suite;
                                                                RunObjectType=Page;
                                                                RunObjectID=359;
                                                                Visible=Yes;
                                                                DepartmentCategory=Lists }
    { MenuItem       ;[{379BBC3B-5EBB-4617-8419-8D76352F8337}] ;Name=Electronic Document Formats;
                                                                CaptionML=[ENU=Electronic Document Formats;
                                                                           NOR=Elektroniske dokumentformater];
                                                                ApplicationArea=#Suite;
                                                                RunObjectType=Page;
                                                                RunObjectID=363;
                                                                Visible=Yes;
                                                                DepartmentCategory=Tasks }
    { MenuItem       ;[{8A3934DD-BE0A-4851-B8E0-50A64106B98A}] ;Name=Data Exchange Types;
                                                                CaptionML=[ENU=Data Exchange Types;
                                                                           NOR=Datautvekslingstyper];
                                                                ApplicationArea=#Basic,#Suite;
                                                                RunObjectType=Page;
                                                                RunObjectID=1213;
                                                                Visible=Yes;
                                                                DepartmentCategory=Administration }
    { MenuItem       ;[{0D3D0EB4-59D7-4D3E-95AC-49CD269C6C04}] ;Name=Data Migration Settings;
                                                                AccessByPermission=TableData 1806=R;
                                                                CaptionML=[ENU=Data Migration Settings;
                                                                           NOR=Innstillinger for datamigrering];
                                                                ApplicationArea=#Basic,#Suite;
                                                                RunObjectType=Page;
                                                                RunObjectID=1807;
                                                                Visible=Yes;
                                                                DepartmentCategory=Administration }
    { MenuItem       ;[{00646221-3EEF-4883-8640-FECFD9BEC705}] ;Name=Report Configuration;
                                                                AccessByPermission=TableData 2000000196=IMD;
                                                                CaptionML=[ENU=Report Settings;
                                                                           NOR=Rapportinnstillinger];
                                                                ApplicationArea=#Basic,#Suite;
                                                                RunObjectType=Page;
                                                                RunObjectID=1560;
                                                                Visible=Yes;
                                                                DepartmentCategory=Administration }
    { MenuItem       ;[{A1E3A413-B0C4-4D20-8B1F-AFF7DFFDB43C}] ;Name=Setup and Help Resources;
                                                                CaptionML=[ENU=Setup and Help Resources;
                                                                           NOR=Ressurser for oppsett og hjelp];
                                                                ApplicationArea=#Basic,#Suite;
                                                                RunObjectType=Page;
                                                                RunObjectID=1822;
                                                                Visible=Yes;
                                                                NextNodeID=[{CADB8703-6DB5-44FD-AB19-1488339F4F9F}];
                                                                DepartmentCategory=Administration }
    {                ;[{387B2D8D-4249-4D63-BE9C-850416EA6E81}] ;NextNodeID=[{34E4BEA4-29EB-4579-8568-973A8449A4A1}] }
    { MenuItem       ;[{34E4BEA4-29EB-4579-8568-973A8449A4A1}] ;Name=Certificates of Supply;
                                                                CaptionML=[ENU=Certificates of Supply;
                                                                           NOR=Mottaksdeklarasjoner];
                                                                RunObjectType=Page;
                                                                RunObjectID=780;
                                                                Visible=Yes;
                                                                NextNodeID=[{3E2FEC16-BE73-41A6-94E5-BAFFDE0CFB12}];
                                                                DepartmentCategory=Lists }
    {                ;[{A07A2127-D15F-4AF6-8301-EC0DA819FAE6}] ;NextNodeID=[{B0697E0F-6AD6-425A-9E5C-F0BD41F9BC72}] }
    { MenuGroup      ;[{B0697E0F-6AD6-425A-9E5C-F0BD41F9BC72}] ;Name=New Group;
                                                                CaptionML=[ENU=Employee Portal;
                                                                           NOR=Employee Portal];
                                                                Visible=Yes }
    { MenuItem       ;[{CADB8703-6DB5-44FD-AB19-1488339F4F9F}] ;Name=Document Module Setup;
                                                                CaptionML=[ENU=Document Module Setup;
                                                                           NOR=Dokumentmodul oppsett];
                                                                ApplicationArea=;
                                                                MemberOfMenu=[{19A352FE-D90D-424E-B85F-CF3B8E98CF0E}];
                                                                RunObjectType=Page;
                                                                RunObjectID=53200;
                                                                ParentNodeID=[{8777433F-97D7-457C-ACDD-2E2620FDC182}];
                                                                Visible=Yes;
                                                                NextNodeID=[{4D3D68E9-6A4A-4F4A-8D33-747D76821EC8}];
                                                                DepartmentCategory=Administration }
  }
}
OBJECT Page 53200 Document Module Setup
{
  OBJECT-PROPERTIES
  {
    Date=28.10.16;
    Time=08:35:57;
    Modified=Yes;
    Version List=DOC1.1;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Document Module Setup;
               NOR=Dokumentmodul oppsett];
    InsertAllowed=Yes;
    DeleteAllowed=No;
    SourceTable=Table53200;
    PageType=Card;
    ActionList=ACTIONS
    {
      { 82100   ;    ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 82101   ;1   ;Action    ;
                      Name=Add Client Control Add-In;
                      CaptionML=[ENU=Add Client Control Add-In;
                                 NOR=Legge til kontrolltillegg];
                      OnAction=VAR
                                 DocumentModuleManagementL@82100 : Codeunit 53201;
                               BEGIN
                                 DocumentModuleManagementL.InsertClientAddIns();
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1101103000;0;Container;
                ContainerType=ContentArea }

    { 1101103001;1;Group  ;
                Name=General;
                CaptionML=[ENU=General;
                           NOR=Generelt];
                GroupType=Group }

    { 1101103002;2;Field  ;
                SourceExpr="Filename No. Series" }

    { 1101103003;2;Field  ;
                SourceExpr="Storage Location";
                OnValidate=BEGIN
                             IF COPYSTR("Storage Location", STRLEN("Storage Location"), 1) <> '\' THEN
                             BEGIN
                               "Storage Location" += '\';
                             END;
                           END;
                            }

    { 1101103004;2;Field  ;
                SourceExpr="Storage Type" }

    { 1101103005;2;Field  ;
                SourceExpr="Add To Record Link" }

    { 1101103006;2;Field  ;
                SourceExpr="Use Attachment Table" }

    { 1101103007;2;Field  ;
                SourceExpr="Add To Interaction Log" }

    { 1101103008;2;Field  ;
                SourceExpr="Add Line To Support Task";
                Visible=FALSE }

    { 1101103009;2;Field  ;
                SourceExpr="Interaction Template Code" }

  }
  CODE
  {

    BEGIN
    {
      +---------------------------------------------+
      | SI-Data                                     |
      +---------------------------------------------+
      No. Date     Id  Description
      01. 12.11.14 JAL Created the object
    }
    END.
  }
}

OBJECT Page 53201 Document Module Documents
{
  OBJECT-PROPERTIES
  {
    Date=28.09.16;
    Time=20:24:34;
    Modified=Yes;
    Version List=DOC1.1;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Document Module Documents;
               NOR=Dokumentmodul Dokumenter];
    InsertAllowed=No;
    SourceTable=Table53201;
    PageType=List;
    OnInit=VAR
             RecIdFilter@1101103000 : Text[250];
           BEGIN
           END;

    OnDeleteRecord=VAR
                     DocumentModuleFiles@1101103000 : Codeunit 53200;
                   BEGIN
                     IF GUIALLOWED AND  CONFIRM (TextDeleteFile, FALSE, FIELDCAPTION("Filename No."), "Filename No.") THEN
                     BEGIN
                       DocumentModuleFiles.DeleteDocument(ConstDiskFileName);
                     END;
                   END;

    ActionList=ACTIONS
    {
      { 1101103010;  ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 1101103012;1 ;ActionGroup;
                      CaptionML=[ENU=Documents;
                                 NOR=Dokumenter];
                      Description=Documents;
                      Image=Setup }
      { 1101103011;2 ;Action    ;
                      Name=Import document;
                      CaptionML=[ENU=Import document;
                                 NOR=Importere dokument];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Add;
                      PromotedCategory=New;
                      OnAction=VAR
                                 DocumentModuleFiles@1101103000 : Codeunit 53200;
                               BEGIN
                                 DocumentModuleFiles.ImportDocument(RelatedRecRef);
                               END;
                                }
      { 1101103016;2 ;Action    ;
                      Name=Connect document;
                      CaptionML=[ENU=Connect document;
                                 NOR=Koble dokument];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Attach;
                      OnAction=VAR
                                 DocumentModuleFiles@1101103000 : Codeunit 53200;
                               BEGIN
                                 DocumentModuleFiles.ConnectDocument(RelatedRecRef);
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1101103000;0;Container;
                ContainerType=ContentArea }

    { 1101103001;1;Group  ;
                Name=Group;
                GroupType=Repeater }

    { 1101103002;2;Field  ;
                SourceExpr=Description }

    { 1101103003;2;Field  ;
                AssistEdit=Yes;
                SourceExpr="Filename No.";
                Editable=False;
                OnAssistEdit=BEGIN
                               HYPERLINK(ConstDiskFileName);
                             END;
                              }

    { 1101103004;2;Field  ;
                SourceExpr=Date }

    { 1101103005;2;Field  ;
                SourceExpr=Time }

    { 1101103013;2;Field  ;
                Name=RecordID;
                SourceExpr=FORMAT(RecordID);
                Editable=False }

    { 1101103006;2;Field  ;
                SourceExpr=Size;
                Visible=False;
                Editable=False }

    { 1101103015;2;Field  ;
                SourceExpr="File Extension";
                Editable=False }

    { 1101103014;2;Field  ;
                SourceExpr="Storage Pointer";
                Editable=False }

    { 1101103007;0;Container;
                ContainerType=FactBoxArea }

    { 1101103008;1;Part   ;
                Visible=False;
                PartType=System;
                SystemPartID=Notes }

    { 1101103009;1;Part   ;
                Visible=False;
                PartType=System;
                SystemPartID=MyNotes }

  }
  CODE
  {
    VAR
      RelatedRecRef@1101103000 : RecordRef;
      TextDeleteFile@1101103001 : TextConst 'ENU=Do you want to delete the file?;NOR=Vil du ogs† slette den underliggende filen?';

    PROCEDURE SetRecordRef@1101103000(RecRef@1101103000 : RecordRef);
    BEGIN
        RelatedRecRef.OPEN(RecRef.RECORDID.TABLENO);
        RelatedRecRef.GET(RecRef.RECORDID);
    END;

    BEGIN
    {
      +---------------------------------------------+
      | SI-Data                                     |
      +---------------------------------------------+
      No. Date     Id  Description
      01. 12.11.14 JAL Created the object
    }
    END.
  }
}

OBJECT Page 53202 Document File FactBox
{
  OBJECT-PROPERTIES
  {
    Date=28.10.16;
    Time=21:58:37;
    Modified=Yes;
    Version List=DOC1.1;
  }
  PROPERTIES
  {
    Editable=No;
    CaptionML=[ENU=Attached Files;
               NOR=Vedlagte filer];
    InsertAllowed=No;
    DeleteAllowed=No;
    ModifyAllowed=No;
    LinksAllowed=No;
    SourceTable=Table53201;
    SourceTableView=SORTING(Table No.,RecordID,Line No.)
                    ORDER(Ascending);
    PageType=ListPart;
    OnInit=BEGIN
             IsFilterSetG := FALSE;
           END;

    OnFindRecord=BEGIN
                   IF IsFilterSetG THEN
                     EXIT(FIND(Which));
                   EXIT(FALSE);
                 END;

    ActionList=ACTIONS
    {
      { 1000000004;  ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 1000000007;1 ;ActionGroup;
                      Name=Action;
                      CaptionML=[ENU=Actions;
                                 NOR=Handlinger];
                      Image=Action }
      { 1000000005;2 ;Action    ;
                      Name=Add Attached File;
                      Ellipsis=Yes;
                      CaptionML=[ENU=Add;
                                 NOR=Legg til];
                      Image=Add;
                      OnAction=BEGIN
                                 DocumentModuleFilesG.ImportDocument(RecordRefG);
                               END;
                                }
      { 1000000006;2 ;Action    ;
                      Name=Save Attached File;
                      Ellipsis=Yes;
                      CaptionML=[ENU=Save;
                                 NOR=Lagre];
                      Image=Save;
                      OnAction=VAR
                                 DocumentModuleDocumentsL@1000000000 : Record 53201;
                               BEGIN
                                 CurrPage.SETSELECTIONFILTER(DocumentModuleDocumentsL);
                                 IF DocumentModuleDocumentsL.FINDSET THEN
                                   REPEAT
                                     DocumentModuleFilesG.SaveFileToClient(DocumentModuleDocumentsL)
                                   UNTIL DocumentModuleDocumentsL.NEXT = 0;
                               END;
                                }
      { 1000000009;2 ;Separator  }
      { 1000000010;2 ;Action    ;
                      Name=Delete Attached File;
                      CaptionML=[ENU=Delete;
                                 NOR=Slett];
                      Image=Delete;
                      OnAction=VAR
                                 DocumentModuleDocumentsL@1000000000 : Record 53201;
                               BEGIN
                                 CurrPage.SETSELECTIONFILTER(DocumentModuleDocumentsL);
                                 IF DocumentModuleDocumentsL.FINDSET THEN
                                   REPEAT
                                     DocumentModuleDocumentsL.DELETE(TRUE);
                                   UNTIL DocumentModuleDocumentsL.NEXT = 0;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1000000000;;Container;
                ContainerType=ContentArea }

    { 1000000002;1;Group  ;
                GroupType=Repeater }

    { 1101103001;2;Field  ;
                SourceExpr=Description;
                OnAssistEdit=BEGIN
                               DocumentModuleFilesG.ShowDocument(Rec);
                               CurrPage.UPDATE(FALSE);
                             END;
                              }

    { 1101103002;2;Field  ;
                SourceExpr="File Extension" }

    { 1101103003;2;Field  ;
                SourceExpr=Date }

    { 1101103000;1;Field  ;
                Name=DragAndDrop;
                ControlAddIn=[Incadea.DropAreaControlAddIn;PublicKeyToken=c7fbc976bcfb9a00];
                ShowCaption=No }

  }
  CODE
  {
    VAR
      Text001@1000000002 : TextConst 'ENU=Drag and drop files or e-mails here!;NOR=Dra og slipp filer eller e-poster her!';
      DocumentModuleFilesG@1101103002 : Codeunit 53200;
      ControlAddInReadyG@1000000003 : Boolean;
      Text002@1000000004 : TextConst 'ENU=Refresh the page after the record is inserted.;NOR=Forny siden etter at posten er satt inn.';
      Text003@1000000005 : TextConst 'ENU=Then try again.;NOR=Deretter pr›v igjen.';
      Text004@1000000008 : TextConst 'ENU=Control add-in is missing.;NOR=Kontrolltillegg mangler.';
      Text005@1101103001 : TextConst 'ENU=Insert a line.;NOR=Sett inn en linje.';
      RecordIDG@1101103000 : RecordID;
      RecordRefG@1101103003 : RecordRef;
      IsFilterSetG@1101103004 : Boolean;

    PROCEDURE LoadDataFromRecord@1101103000(VariantP@1101103000 : Variant);
    BEGIN
      RecordRefG.GETTABLE(VariantP);
      IF NOT RecordRefG.GET(RecordRefG.RECORDID) THEN
        EXIT;
      RecordIDG := RecordRefG.RECORDID;
      Rec.SETCURRENTKEY("Table No.", RecordID, "Line No.");
      Rec.SETRANGE("Table No.", RecordIDG.TABLENO);
      Rec.SETRANGE(RecordID, RecordIDG);
      IsFilterSetG := TRUE;
      CurrPage.UPDATE(FALSE)
    END;

    EVENT DragAndDrop@-1101103000::ControlAddInReady@2();
    BEGIN
      ControlAddInReadyG := TRUE;
    END;

    EVENT DragAndDrop@-1101103000::FileDropBegin@3(filename@1101103000 : Text);
    BEGIN
    END;

    EVENT DragAndDrop@-1101103000::FileDrop@4(data@1101103000 : Text);
    BEGIN
    END;

    EVENT DragAndDrop@-1101103000::FileAdded@5(FilePathAndName@1101103000 : Text);
    BEGIN
      IF ControlAddInReadyG THEN BEGIN
        DocumentModuleFilesG.ImportDocumentFromFile(RecordRefG, FilePathAndName);
      END;
    END;

    EVENT DragAndDrop@-1101103000::FileDropEnd@6();
    BEGIN
    END;

    BEGIN
    {
      +---------------------------------------------+
      | Incadea Norge AS                            |
      +---------------------------------------------+
      No. Date     Id  Description
      01. 20.09.16 JAL Document Module Factbox
    }
    END.
  }
}

